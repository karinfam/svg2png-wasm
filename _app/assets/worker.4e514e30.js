(function(){"use strict";var r,C=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});C.decode();var A=new Uint8Array;function b(){return A.byteLength===0&&(A=new Uint8Array(r.memory.buffer)),A}function E(e,n){return C.decode(b().subarray(e,e+n))}var u=new Array(32).fill(void 0);u.push(void 0,null,!0,!1);var p=u.length;function L(e){p===u.length&&u.push(u.length+1);const n=p;return p=u[n],u[n]=e,n}function T(e){return u[e]}function x(e){e<36||(u[e]=p,p=e)}function S(e){const n=T(e);return x(e),n}var _=0;function $(e,n){const t=n(e.length*1);return b().set(e,t/1),_=e.length,t}var k=new TextEncoder("utf-8"),q=typeof k.encodeInto=="function"?function(e,n){return k.encodeInto(e,n)}:function(e,n){const t=k.encode(e);return n.set(t),{read:e.length,written:t.length}};function g(e,n,t){if(t===void 0){const s=k.encode(e),f=n(s.length);return b().subarray(f,f+s.length).set(s),_=s.length,f}let i=e.length,a=n(i);const c=b();let o=0;for(;o<i;o++){const s=e.charCodeAt(o);if(s>127)break;c[a+o]=s}if(o!==i){o!==0&&(e=e.slice(o)),a=t(a,i,i=o+e.length*3);const s=b().subarray(a+o,a+i);o+=q(e,s).written}return _=o,a}function d(e){return e==null}var M=new Int32Array;function y(){return M.byteLength===0&&(M=new Int32Array(r.memory.buffer)),M}function B(e,n){return b().subarray(e/1,e/1+n)}var U=new Uint32Array;function D(){return U.byteLength===0&&(U=new Uint32Array(r.memory.buffer)),U}function N(e,n){const i=D().subarray(e/4,e/4+n),a=[];for(let c=0;c<i.length;c++)a.push(S(i[c]));return a}function V(e,n,t,i,a){var c=d(e)?0:g(e,r.__wbindgen_malloc,r.__wbindgen_realloc),o=_,s=d(n)?0:g(n,r.__wbindgen_malloc,r.__wbindgen_realloc),f=_,w=d(t)?0:g(t,r.__wbindgen_malloc,r.__wbindgen_realloc),F=_,v=d(i)?0:g(i,r.__wbindgen_malloc,r.__wbindgen_realloc),l=_,m=d(a)?0:g(a,r.__wbindgen_malloc,r.__wbindgen_realloc),h=_;const W=r.createConverter(c,o,s,f,w,F,v,l,m,h);return O.__wrap(W)}var O=class{static __wrap(e){const n=Object.create(O.prototype);return n.ptr=e,n}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();r.__wbg_converter_free(e)}registerFont(e){const n=$(e,r.__wbindgen_malloc),t=_;r.converter_registerFont(this.ptr,n,t)}convert(e,n,t,i,a){try{const l=r.__wbindgen_add_to_stack_pointer(-16),m=g(e,r.__wbindgen_malloc,r.__wbindgen_realloc),h=_;var c=d(a)?0:g(a,r.__wbindgen_malloc,r.__wbindgen_realloc),o=_;r.converter_convert(l,this.ptr,m,h,!d(n),d(n)?0:n,!d(t),d(t)?0:t,!d(i),d(i)?0:i,c,o);var s=y()[l/4+0],f=y()[l/4+1],w=y()[l/4+2],F=y()[l/4+3];if(F)throw S(w);var v=B(s,f).slice();return r.__wbindgen_free(s,f*1),v}finally{r.__wbindgen_add_to_stack_pointer(16)}}list_fonts(){try{const i=r.__wbindgen_add_to_stack_pointer(-16);r.converter_list_fonts(i,this.ptr);var e=y()[i/4+0],n=y()[i/4+1],t=N(e,n).slice();return r.__wbindgen_free(e,n*4),t}finally{r.__wbindgen_add_to_stack_pointer(16)}}};async function H(e,n){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,n)}catch(i){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",i);else throw i}const t=await e.arrayBuffer();return await WebAssembly.instantiate(t,n)}else{const t=await WebAssembly.instantiate(e,n);return t instanceof WebAssembly.Instance?{instance:t,module:e}:t}}function J(){const e={};return e.wbg={},e.wbg.__wbindgen_string_new=function(n,t){const i=E(n,t);return L(i)},e.wbg.__wbg_new_abda76e883ba8a5f=function(){const n=new Error;return L(n)},e.wbg.__wbg_stack_658279fe44541cf6=function(n,t){const i=T(t).stack,a=g(i,r.__wbindgen_malloc,r.__wbindgen_realloc),c=_;y()[n/4+1]=c,y()[n/4+0]=a},e.wbg.__wbg_error_f851667af71bcfc6=function(n,t){try{console.error(E(n,t))}finally{r.__wbindgen_free(n,t)}},e.wbg.__wbindgen_object_drop_ref=function(n){S(n)},e.wbg.__wbindgen_throw=function(n,t){throw new Error(E(n,t))},e}function P(e,n){return r=e.exports,R.__wbindgen_wasm_module=n,M=new Int32Array,U=new Uint32Array,A=new Uint8Array,r.__wbindgen_start(),r}async function R(e){typeof e=="undefined"&&(e=new URL("svg2png_wasm_bg.wasm",void 0));const n=J();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:t,module:i}=await H(await e,n);return P(t,i)}var G=R,I=!1,K=async e=>{if(I)throw new Error("Already initialized. The `initialize` function can be used only once.");await G(await e),I=!0},Q=e=>{if(!I)throw new Error("WASM has not been initialized. Call `initialize` function.");let n,t,i,a,c,o;if(e&&e.defaultFontFamily&&(e.defaultFontFamily.serifFamily&&(t=e.defaultFontFamily.serifFamily),e.defaultFontFamily.sansSerifFamily&&(i=e.defaultFontFamily.sansSerifFamily),e.defaultFontFamily.cursiveFamily&&(a=e.defaultFontFamily.cursiveFamily),e.defaultFontFamily.fantasyFamily&&(c=e.defaultFontFamily.fantasyFamily),e.defaultFontFamily.monospaceFamily&&(o=e.defaultFontFamily.monospaceFamily)),n=V(t,i,a,c,o),e&&e.fonts)for(const f of e.fonts)n.registerFont(f);const s=(f,w)=>new Promise((F,v)=>{try{let l,m,h,W;if(w&&(l=w.scale,m=w.width,h=w.height,W=w.backgroundColor),n){const j=n.convert(f,l,m,h,W);j&&F(j)}else throw new Error("Converter already disposed.")}catch(l){l instanceof Error?v(l):v(new Error(`${l}`))}});return s.dispose=()=>{n&&(n.free(),n=void 0)},s.getLoadedFontFamilies=()=>n?n.list_fonts():[],s};console.log("worker initializing");let z;self.addEventListener("message",e=>{const n=e.data;if(!(typeof n!="object"||n==null))switch(console.log(`worker ${n.type}`),n.type){case"initialize":K("/svg2png-wasm/svg2png.wasm").then(()=>{z=Q(n.options)});break;case"svg2png":z===void 0?self.postMessage({type:"error",error:"svg2png has not been initialized."}):z(n.svg,n.options).then(t=>self.postMessage({id:n.id,type:"success",data:t})).catch(t=>self.postMessage({id:n.id,type:"error",error:`${t}`}));break}})})();
